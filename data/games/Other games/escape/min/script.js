function H(){this.A=function(e){for(var f=0;24>f;f++)this[String.fromCharCode(97+f)]=e[f]||0;0.01>this.c&&(this.c=0.01);e=this.b+this.c+this.e;0.18>e&&(e=0.18/e,this.b*=e,this.c*=e,this.e*=e)}}var U=new function(){this.z=new H;var e,f,d,h,j,w,I,J,K,y,k,L;this.reset=function(){var b=this.z;h=100/(b.f*b.f+0.001);j=100/(b.g*b.g+0.001);w=1-0.01*b.h*b.h*b.h;I=1E-6*-b.i*b.i*b.i;b.a||(k=0.5-b.n/2,L=5E-5*-b.o);J=1+b.l*b.l*(0<b.l?-0.9:10);K=0;y=1==b.m?0:2E4*(1-b.m)*(1-b.m)+32};this.C=function(){this.reset();var b=this.z;e=1E5*b.b*b.b;f=1E5*b.c*b.c;d=1E5*b.e*b.e+12;return 3*((e+f+d)/3|0)};this.B=function(b,M){var a=this.z,N=1!=a.s||a.v,o=0.1*a.v*a.v,O=1+3E-4*a.w,l=0.1*a.s*a.s*a.s,V=1+1E-4*a.t,W=1!=a.s,X=a.x*a.x,Y=a.g,P=a.q||a.r,Z=0.2*a.r*a.r*a.r,B=a.q*a.q*(0>a.q?-1020:1020),Q=a.p?(2E4*(1-a.p)*(1-a.p)|0)+32:0,$=a.d,R=a.j/2,aa=0.01*a.k*a.k,C=a.a,D=e,ba=1/e,ca=1/f,da=1/d,a=5/(1+20*a.u*a.u)*(0.01+l);0.8<a&&(a=0.8);for(var a=1-a,E=!1,S=0,s=0,t=0,z=0,q=0,u,r=0,g,m=0,p,F=0,c,T=0,n,G=0,A=Array(1024),v=Array(32),i=A.length;i--;)A[i]=0;for(i=v.length;i--;)v[i]=2*Math.random()-1;for(i=0;i<M;i++){if(E)return i;Q&&++T>=Q&&(T=0,this.reset());y&&++K>=y&&(y=0,h*=J);w+=I;h*=w;h>j&&(h=j,0<Y&&(E=!0));g=h;0<R&&(G+=aa,g*=1+Math.sin(G)*R);g|=0;8>g&&(g=8);C||(k+=L,0>k?k=0:0.5<k&&(k=0.5));if(++s>D)switch(s=0,++S){case 1:D=f;break;case 2:D=d}switch(S){case 0:t=s*ba;break;case 1:t=1+2*(1-s*ca)*$;break;case 2:t=1-s*da;break;case 3:t=0,E=!0}P&&(B+=Z,p=B|0,0>p?p=-p:1023<p&&(p=1023));N&&O&&(o*=O,1E-5>o?o=1E-5:0.1<o&&(o=0.1));n=0;for(var ea=8;ea--;){m++;if(m>=g&&(m%=g,3==C))for(u=v.length;u--;)v[u]=2*Math.random()-1;switch(C){case 0:c=m/g<k?0.5:-0.5;break;case 1:c=1-2*(m/g);break;case 2:c=m/g;c=6.28318531*(0.5<c?c-1:c);c=1.27323954*c+0.405284735*c*c*(0>c?1:-1);c=0.225*((0>c?-1:1)*c*c-c)+c;break;case 3:c=v[Math.abs(32*m/g|0)]}N&&(u=r,l*=V,0>l?l=0:0.1<l&&(l=0.1),W?(q+=(c-r)*l,q*=a):(r=c,q=0),r+=q,z+=r-u,c=z*=1-o);P&&(A[F%1024]=c,c+=A[(F-p+1024)%1024],F++);n+=c}n*=0.125*t*X;b[i]=1<=n?32767:-1>=n?-32768:32767*n|0}return M}};window.jsfxr=function(e){U.z.A(e);var f=U.C(),e=new Uint8Array(4*((f+1)/2|0)+44),f=2*U.B(new Uint16Array(e.buffer,44),f),d=new Uint32Array(e.buffer,0,44);d[0]=1179011410;d[1]=f+36;d[2]=1163280727;d[3]=544501094;d[4]=16;d[5]=65537;d[6]=44100;d[7]=88200;d[8]=1048578;d[9]=1635017060;d[10]=f;for(var f=f+44,d=0,h="data:audio/wav;base64,",x="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";d<f;d+=3)var j=e[d]<<16|e[d+1]<<8|e[d+2],h=h+(x[j>>18]+x[j>>12&63]+x[j>>6&63]+x[j&63]);return h};
function createCanvas(t,n){var e=document.createElement("canvas");return e.height=e.width=t,n(e.getContext("2d"))}function btouv(e){return 45*e+4}function paintField(e){var t,n;for(e.fillStyle="#89867e",e.fillRect(0,0,412,412),e.fillStyle="#fcf6f0",t=0;9>t;++t)for(n=0;9>n;++n)8==t&&4==n?(e.fillStyle="#fb3",e.fillRect(btouv(t),btouv(n),44,44),e.fillStyle="#fcf6f0"):e.fillRect(btouv(t),btouv(n),44,44);return e.beginPath(),e.moveTo(btouv(3),btouv(4)),e.lineTo(btouv(4)+22,btouv(4)),e.lineTo(btouv(4)+22,btouv(3)+22),e.lineTo(btouv(5)+44,btouv(4)+22),e.lineTo(btouv(4)+22,btouv(5)+22),e.lineTo(btouv(4)+22,btouv(4)+44),e.lineTo(btouv(3),btouv(4)+44),e.closePath(),e.fillStyle="#e9e3dd",e.lineWidth=4,e.strokeStyle="#89867e",e.fill(),e.stroke(),e.canvas.toDataURL()}function paintFieldG(e){var t,n,a,i,s,o;for(e.fillStyle="#fcf6f0",e.fillRect(0,0,412,412),t=0;9>t;++t)for(n=0;9>n;++n)for(s=btouv(t),o=btouv(n),a=0;11>a;++a)for(i=0;11>i;++i)e.fillStyle="#"+_grass[0|11*Math.random()],e.fillRect(4*a+s,4*i+o,4,4);return e.canvas.toDataURL()}function $id(e){return document.getElementById(e)}function rand0(e){return e*(Math.random()-.5)}function max(e,t){return t>e?t:e}function min(e,t){return e>t?t:e}function pspOff(){$scr.className="nopsp"}function rand9(e){return((rand9_gt0=!rand9_gt0)?1:-1)*e*max(Math.random(),.1)}function pspAny(){$scr.className="",$psp.style.transform="rotateX("+(0|40+rand0(10))+"deg) rotateZ("+(0|rand9(25))+"deg)"}function bind_opt(e){$id(e).addEventListener("change",function(t){opt[e]=t.target.checked},!1)}function makeBGM(){var e,t="";for(e=0;524288>e;++e)t+=String.fromCharCode((128&e*(15&"36364689"[7&e>>13])/12)+(127&((e>>12^(e>>12)-2)%11*e/4|e>>13)));return"RIFF_oO_WAVEfmt"+atob("IBAAAAABAAEARKwAAAAAAAABAAgAZGF0YU")+t+t}function ArcadeAudio(){this.sounds={}}function controls(e){if(!e.defaultPrevented)if(escapist.levelComplete)e.preventDefault();else{switch(e.key||e.keyCode){case"Up":case"ArrowUp":case"w":case"W":case"k":case"K":case 38:case 87:case 75:escapist.y=max(0,escapist.y-1);break;case"Left":case"ArrowLeft":case"a":case"A":case"h":case"H":case 37:case 65:case 72:escapist.x=max(0,escapist.x-1);break;case"Down":case"ArrowDown":case"s":case"S":case"j":case"J":case 40:case 83:case 74:escapist.y=min(8,escapist.y+1);break;case"Right":case"ArrowRight":case"d":case"D":case"l":case"L":case 39:case 68:case 76:escapist.x=min(8,escapist.x+1);break;case"9":case 57:restartGame();break;case"]":case 221:escapist.x=8,escapist.y=4;break;default:return}escapist.$update(),escapist.levelComplete||testCaught()||enemyTurn(),e.preventDefault(),aa.play("go"),removeHelp()}}function moved(){escapist.levelComplete&&nextLevel()}function enemyHTML(e,t,n,a){return'<div class="c h '+t+'" id='+e+" data-x="+n+" data-y="+a+"><div class=i></div><div class=j></div><div class=k></div><div class=l></div></div>"}function insertBlock(t,n,a){var e="blk"+ ++autoIncrement;return $psp.insertAdjacentHTML("beforeend",enemyHTML(e,t,n,a)),$id(e)}function Enemy(a,t){this.cn=a,this.x=t.head[0],this.y=t.head[1],this.$=insertBlock(a,this.x,this.y),this.$tail=[];for(var n=0;n<t.tail.length;++n){var e=t.tail[n],e={x:e[0],y:e[1],$:insertBlock(a+" t"+n,e[0],e[1])};this.$tail.push(e)}setTimeout(this.reveal.bind(this))}function nextLevel(e){enemy1&&(enemy1.remove(),enemy1=null),enemy2&&(enemy2.remove(),enemy2=null),depth?(pspAny(),escapist.x=0,escapist.y=4,escapist.$update(),void 0===e?--depth:depth=e,$depth.nodeValue=depth,$msg.nodeValue=msgs[depth],depth||($scr.className="win",aa.play("win"),e="x"),enemy1setup[depth].head&&(enemy1=new Enemy("enr",enemy1setup[depth])),enemy2setup[depth].head&&(enemy2=new Enemy("enb",enemy2setup[depth])),e||aa.play("lvl")):escapist.levelComplete=!1}function enemyTurn(){enemy1&&_enemyTurn(enemy1),enemy2&&_enemyTurn(enemy2)}function _enemyTurn(t){var e,n,a=[];for(e=0;9>e;++e)for(a[e]=[],n=0;9>n;++n)a[e][n]=8==e&&4==n?0:1;if(enemy1)for(e=0;e<enemy1.$tail.length;++e)a[enemy1.$tail[e].x][enemy1.$tail[e].y]=0;if(enemy2)for(e=0;e<enemy2.$tail.length;++e)a[enemy2.$tail[e].x][enemy2.$tail[e].y]=0;if(t===enemy1?enemy2&&(a[enemy2.x][enemy2.y]=0):enemy1&&(a[enemy1.x][enemy1.y]=0),e=new Graph(a),n=astar.search(e,e.grid[t.x][t.y],e.grid[escapist.x][escapist.y]),n.length){for(e=t.$tail.length-1;e>-1;--e){var a=t.$tail[e],i=e?t.$tail[e-1]:t;a.x=i.x,a.y=i.y}t.x=n[0].x,t.y=n[0].y,t.$update(),testCaught()}}function testCaught(){return enemy1&&enemy1.hasPlayer()||enemy2&&enemy2.hasPlayer()?(nextLevel(++depth),9==depth&&pspOff(),$caught.className="s",aa.play("bad"),!0):!1}function throwBack(){$caught.className=""}function restartGame(){nextLevel(depth=9),pspOff()}!function(){function a(e){for(var t=[];e.parent;)t.push(e),e=e.parent;return t.reverse()}function s(){return new i(function(e){return e.f})}function t(i,a){a=a||{},this.nodes=[],this.diagonal=!!a.diagonal,this.grid=[];for(var t=0;t<i.length;t++){this.grid[t]=[];for(var n=0,s=i[t];n<s.length;n++){var o=new e(t,n,s[n]);this.grid[t][n]=o,this.nodes.push(o)}}}function e(e,t,n){this.x=e,this.y=t,this.weight=n}function i(e){this.content=[],this.scoreFunction=e}var n={init:function(n){for(var t=0,a=n.nodes.length;a>t;++t){var e=n.nodes[t];e.f=0,e.g=0,e.h=0,e.visited=!1,e.closed=!1,e.parent=null}},search:function(u,t,c,i){n.init(u),i=i||{};var p=i.heuristic||n.heuristics.manhattan;i=i.closest||!1;var r=s(),o=t;for(t.h=p(t,c),r.push(t);0<r.size();){if(t=r.pop(),t===c)return a(t);t.closed=!0;for(var l=u.neighbors(t),h=0,y=l.length;y>h;++h){var e=l[h];if(!e.closed&&!e.isWall()){var d=t.g+e.getCost(t),f=e.visited;(!f||d<e.g)&&(e.visited=!0,e.parent=t,e.h=e.h||p(e,c),e.g=d,e.f=e.g+e.h,i&&(e.h<o.h||e.h===o.h&&e.g<o.g)&&(o=e),f?r.rescoreElement(e):r.push(e))}}}return i?a(o):[]},heuristics:{manhattan:function(e,t){var n=Math.abs(t.x-e.x),a=Math.abs(t.y-e.y);return n+a},diagonal:function(e,t){var i=Math.sqrt(2),n=Math.abs(t.x-e.x),a=Math.abs(t.y-e.y);return 1*(n+a)+(i-2)*Math.min(n,a)}}};t.prototype.neighbors=function(n){var a=[],e=n.x;n=n.y;var t=this.grid;return t[e-1]&&t[e-1][n]&&a.push(t[e-1][n]),t[e+1]&&t[e+1][n]&&a.push(t[e+1][n]),t[e]&&t[e][n-1]&&a.push(t[e][n-1]),t[e]&&t[e][n+1]&&a.push(t[e][n+1]),this.diagonal&&(t[e-1]&&t[e-1][n-1]&&a.push(t[e-1][n-1]),t[e+1]&&t[e+1][n-1]&&a.push(t[e+1][n-1]),t[e-1]&&t[e-1][n+1]&&a.push(t[e-1][n+1]),t[e+1]&&t[e+1][n+1]&&a.push(t[e+1][n+1])),a},t.prototype.toString=function(){for(var t,n,e,i,s=[],o=this.grid,a=0,r=o.length;r>a;a++){for(t=[],n=o[a],e=0,i=n.length;i>e;e++)t.push(n[e].weight);s.push(t.join(" "))}return s.join("\n")},e.prototype.toString=function(){return"["+this.x+" "+this.y+"]"},e.prototype.getCost=function(){return this.weight},e.prototype.isWall=function(){return 0===this.weight},i.prototype={push:function(e){this.content.push(e),this.sinkDown(this.content.length-1)},pop:function(){var e=this.content[0],t=this.content.pop();return 0<this.content.length&&(this.content[0]=t,this.bubbleUp(0)),e},remove:function(t){var e=this.content.indexOf(t),n=this.content.pop();e!==this.content.length-1&&(this.content[e]=n,this.scoreFunction(n)<this.scoreFunction(t)?this.sinkDown(e):this.bubbleUp(e))},size:function(){return this.content.length},rescoreElement:function(e){this.sinkDown(this.content.indexOf(e))},sinkDown:function(e){for(var n=this.content[e];e>0;){var t=(e+1>>1)-1,a=this.content[t];if(!(this.scoreFunction(n)<this.scoreFunction(a)))break;this.content[t]=n,this.content[e]=a,e=t}},bubbleUp:function(n){for(var s=this.content.length,o=this.content[n],r=this.scoreFunction(o);;){var i,a=n+1<<1,t=a-1,e=null;if(s>t&&(i=this.scoreFunction(this.content[t]),r>i&&(e=t)),s>a&&(t=this.scoreFunction(this.content[a]),(null===e?r:i)>t&&(e=a)),null===e)break;this.content[n]=this.content[e],this.content[e]=o,n=e}}},window.astar=n,window.Graph=t}();var _grass="74b44a166a63c15f9f35155952b1a0cf70195c46576b64c163a339163a339176b64c176b64c176b64c".split(1),floor=createCanvas(412,paintField),grass=createCanvas(412,paintFieldG),style=document.createElement("style"),css='#fl{background:url("'+floor+'")}',i;for(i=0;9>i;++i)css+='[data-x="%"]{left:#px}[data-y="%"]{top:#px}'.replace(/%/g,i).replace(/#/g,btouv(i));css+='.win #fl{background:url("'+grass+'")}',style.appendChild(document.createTextNode(css)),document.head.appendChild(style);var $scr=$id("scr"),$psp=$id("psp"),rand9_gt0=1,opt={snd:1};bind_opt("snd");var bgm=new Audio("data:audio/wav;base64,"+btoa(makeBGM()));bgm.loop=!0,bgm.volume=.33,$id("mus").addEventListener("change",function(e){e=e.target.checked,bgm[e?"play":"pause"](),e||(bgm.currentTime=0)},!1),ArcadeAudio.prototype.add=function(e,n,a){var t;this.sounds[e]=[],a.forEach(function(i,s){for(this.sounds[e].push({tick:0,count:n,pool:[]}),t=0;n>t;++t){var a=new Audio;a.src=jsfxr(i),this.sounds[e][s].pool.push(a)}},this)},ArcadeAudio.prototype.play=function(e){opt.snd&&(e=this.sounds[e],e=1<e.length?e[0|Math.random()*e.length]:e[0],e.pool[e.tick].play(),e.tick<e.count-1?e.tick++:e.tick=0)};var aa=new ArcadeAudio;aa.add("lvl",2,[[2,.0703,.4438,.1843,.3133,.7169,,-.3947,.2224,,,-.8926,,,.0018,.5304,.0024,-.0733,.9999,8e-4,,,.001,.5]]),aa.add("bad",2,[[1,.4882,.1015,.0111,.185,.5532,,.2042,-.2355,-8e-4,.167,.1466,.2996,.4515,3e-4,.6633,-.0922,4e-4,.4611,.0765,,.0034,-.4309,.5]]),aa.add("go",10,[[0,,.1095,,.0704,.5058,,,,,,,,.0765,,,,,1,,,.1,,.5]]),aa.add("win",1,[[1,.1802,.6588,.0408,.5046,.5889,,-.4668,.9709,,.6701,-.4295,,-.4146,.0436,.7555,-.0819,-.9671,.1275,.6194,,.0893,.3871,.5]]);var removeHelp=function(){$id("hlp").className="off",removeHelp=function(){}},escapist={x:0,y:4,levelComplete:!1,$:document.getElementsByClassName("pl")[0],$update:function(){this.$.dataset.x=this.x,this.$.dataset.y=this.y,this.levelComplete=8==this.x&&4==this.y}};window.addEventListener("keydown",controls,!0),escapist.$.addEventListener("transitionend",moved,!1);var autoIncrement=0;Enemy.prototype.reveal=function(){var t="c "+this.cn;this.$.className=t;for(var e=0;e<this.$tail.length;++e)this.$tail[e].$.className=t+" t"+e},Enemy.prototype.remove=function(){$psp.removeChild(this.$);for(var e=0;e<this.$tail.length;++e)$psp.removeChild(this.$tail[e].$)},Enemy.prototype.$update=function(){this.$.dataset.x=this.x,this.$.dataset.y=this.y;for(var t=0;t<this.$tail.length;++t){var e=this.$tail[t];e.$.dataset.x=e.x,e.$.dataset.y=e.y}},Enemy.prototype.hasPlayer=function(){if(this.x==escapist.x&&this.y==escapist.y)return!0;for(var e=0;e<this.$tail.length;++e){var t=this.$tail[e];if(t.x==escapist.x&&t.y==escapist.y)return!0}return!1};var depth=9,$depth=$id("dp").firstChild,msgs="This was a triumph;Paint it red;Unlikely;Narrow escape;We swarm;Switchback;Stay with me;Easy mode;You are (not) alone;Escape the pit".split(";"),$msg=$id("msg").firstChild,$caught=$id("fu"),enemy1setup=[{},{head:[3,4],tail:[[4,4],[5,4]]},{head:[7,3],tail:[[6,3],[5,3],[5,4],[5,5]]},{head:[3,6],tail:[[3,6],[3,5],[3,4],[3,3]]},{head:[1,3],tail:[[1,2],[2,2]]},{head:[4,7],tail:[[5,7],[6,7],[6,6]]},{head:[2,1],tail:[[2,0],[1,0],[0,0]]},{head:[2,7],tail:[[2,8],[3,8],[4,8],[5,8]]},{head:[2,1],tail:[[3,1],[4,1],[5,1]]},{}],enemy2setup=[{},{head:[2,6],tail:[[2,7],[1,7],[1,8]]},{head:[6,4],tail:[[7,4],[7,5]]},{head:[5,2],tail:[[5,3],[5,4],[5,5],[5,6]]},{head:[2,5],tail:[[2,6],[3,6]]},{head:[6,4],tail:[[5,4],[4,4],[3,4],[2,4]]},{head:[7,3],tail:[[7,4],[7,5],[8,5],[8,6]]},{head:[6,1],tail:[[7,1],[8,1],[8,2]]},{},{}],enemy1=null,enemy2=null;$caught.addEventListener("transitionend",throwBack,!1);