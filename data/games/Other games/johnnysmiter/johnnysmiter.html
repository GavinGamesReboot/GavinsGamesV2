<!doctype html><html><head><title>js13k</title><style>html{width: 100%;height: 100%;}body{display:none;margin:0;width: 100%;height: 100%;overflow: hidden;}canvas{width: 100%;height: 100%;}h1{position: absolute;color: #9d712d;text-shadow: 0px 0px 20px #fff,0px 0px 30px #fff,0px 0px 40px #fff;left: 0px;top: 20px;margin: 0;width: 100%;text-align: center;font-weight: normal;font-size: 42px;font-style: italic;background-color: #c8bdab;border: 2px solid #9d712d;}h1 span{color: #ff8a00;}#health,#smote{font-size: 32px;color: #fff;text-shadow: 0px 0px 1px #000;position: absolute;bottom: 20px;left: 20px;}#smote{left: auto;right: 20px;}#bar{display: block;background-color: rgba(0,255,0,0.5);height: 20px;width: 300px;}#overlay, #underlay{width: 100%;height: 100%;position: absolute;background-size: 100% 100%;background-attachment:fixed;background-repeat:no-repeat;left: 0px;top: 0px;}#underlay{background-color:#c8bdab;opacity: 0.5;-moz-transition-property: opacity;-moz-transition-duration: 4s;-webkit-transition-property: opacity;-webkit-transition-duration: 4s;-o-transition-property: opacity;-o-transition-duration: 4s;transition-property: opacity;transition-duration: 4s;}#underlay.hide{opacity: 0;}#gameover{position: absolute;width: 100%;text-align: center;bottom: 100px;font-size: 42px;color: rgba(255,255,255,0);display: block;text-shadow: 0px -5px 10px #ff0, 0px -10px 15px #f00, 0px 0px 2px #fff, 0px 0px 20px #000;display: none;}#startgame{position: absolute;width: 100%;top: 150px;-moz-transition-property: opacity, top;-moz-transition-duration: 4s;-webkit-transition-property: opacity, top;-webkit-transition-duration: 4s;-o-transition-property: opacity, top;-o-transition-duration: 4s;transition-property: opacity, top;transition-duration: 4s;}#intro{margin: auto;color:#fff;width: 450px;font-size: 20px;padding: 20px;border: 5px solid #9d712d;opacity: 0.8;text-shadow: 0px 0px 5px #fff, 0px 0px 10px #fff;text-align: center;}#startgame.hide{top: -1000px;opacity: 0;}#intro a{text-decoration: none;color: #9d712d;font-size: 32px;display: block;background-color: #c8bdab;border: 2px solid #9d712d;}#bi{width: 300px;height: 20px;opacity: 0.5;border: 2px solid #9d712d;}</style></head><body><canvas id="canvas" width="800" height="500"></canvas><div id="underlay"></div><div id="overlay"></div><h1><span>J</span>ohnny <span>S</span>miter: <span>13</span>th <span>K</span>night</h1><div id="health">health:<div id="bi"><div id="bar"></div></div></div><div id="smote">Smote:<div id="smotenum">0</div></div><div id="gameover">Your soul has burned in the firey hells of the 13th realm</div><div id="startgame"><div id="intro"><p>Welcome to Jar, a once peaceful land, now plauged by the evil fire creatures of the 13th realm.</p><p>As the 13th Knight of Jar it is your sacred duty to defend the lands of Jar from the invading hoards, banishing the evil creatures back to their fiery realm with your blessed spear.</p><p>But, be warned the presence of these creatures can burn the souls of even the most righteous of men.</p><a href="javascript:startGame();">Begin Quest</a><p><small><b>Controls:</b> WASD, click and drag + right click to throw spear</small></p></div></div><div id="debug"></div><script id="particle-vs" type="x-shader/x-fragment">attribute vec4 aPosition;uniform float uTime;uniform float uState;uniform mat4 uMVMatrix;uniform mat4 uPMatrix;varying vec2 vTextureCoord;varying float vTime;const float life=2000.0;float random(float x,float y){return (fract(sin(dot(vec2(x,y) ,vec2(12.9898,78.233))) * 43758.5453)-0.5)*2.0;}void main(){float i=aPosition.w;float t=mod(random(i,i+1.0)*life+uTime,life)*0.001;vec3 v=vec3(random(i,i+1.0+aPosition.x)*0.3,random(i,i+5.0)+1.0,random(i,i+6.0)*0.3)*0.8*(uState*0.1+1.0);vec3 offset=t*t*v*0.5;vec4 p1=uMVMatrix * vec4(offset,1.0);vTextureCoord=aPosition.xy+vec2(sin(t*6.28+aPosition.y*10.0)*0.1,0.0);vTime=t;gl_Position=uPMatrix * vec4(p1.xyz+(aPosition.xyz-0.5)*2.0,1.0);}</script><script id="particle-fs" type="x-shader/x-fragment"> precision highp float;uniform sampler2D texture1;uniform float uState;varying vec2 vTextureCoord;varying float vTime;void main(void){vec4 tx=texture2D(texture1, vTextureCoord);float t=2.0-vTime;gl_FragColor=vec4(mix(tx.rgb,vec3(0.0,0.0,1.0),uState/100.0),tx.a*t*t*(1.0-uState/100.0));}</script><script id="shader-fs" type="x-shader/x-fragment"> precision highp float;uniform sampler2D texture1;uniform sampler2D texture2;uniform float uUseAlpha;varying vec2 vTextureCoord;varying vec3 vVertexNormal;void main(void){vec4 tex;if(vTextureCoord.x<45.0){tex=texture2D(texture1, vTextureCoord);}else{tex=texture2D(texture2, vTextureCoord);}if(tex.a<0.4) discard;float fog=pow(min(1.0,gl_FragCoord.z/gl_FragCoord.w*0.005),1.2);vec3 n=normalize(vVertexNormal);gl_FragColor=mix(vec4(tex.rgb*(clamp(dot(n,vec3(0.9,0.4,0.0)),0.0,1.0)+0.4),1.0),vec4(0.3, 0.3, 0.32,1.0),fog);if(uUseAlpha>0.0) gl_FragColor=vec4(0.0,0.0,0.0,(0.9-tex.r)*0.5);}</script><script id="shader-fs2" type="x-shader/x-fragment"> precision highp float;uniform sampler2D texture1;uniform sampler2D texture2;uniform sampler2D texture3;varying vec2 vTextureCoord;varying vec3 vVertexNormal;varying vec3 vNormal;void main(void){vec3 n=normalize(vNormal);vec4 tex=texture2D(texture1, vTextureCoord*0.05);vec4 tex2=texture2D(texture2, vTextureCoord*0.2);vec4 tex3=texture2D(texture3, vTextureCoord*0.25);tex=mix(tex,tex3,pow(dot(n,vec3(0.0,0.0,1.0)),10.0));tex=mix(tex,tex2,pow(dot(n,vec3(0.0,0.0,1.0)),80.0));n=normalize(vVertexNormal);float fog=pow(min(1.0,gl_FragCoord.z/gl_FragCoord.w*0.005),1.2);gl_FragColor=vec4(mix(tex.rgb*(clamp(dot(n,vec3(0.9,0.4,0.0)),0.0,1.0)+0.4)*0.35,vec3(0.3, 0.3, 0.32),fog),1.0);}</script><script id="shader-vs" type="x-shader/x-vertex"> attribute vec3 aVertexPosition;attribute vec3 aVertexNormal;attribute vec2 aTextureCoord;uniform mat4 uMVMatrix;uniform mat4 uNMatrix;uniform mat4 uPMatrix;varying vec2 vTextureCoord;varying vec3 vVertexNormal;varying vec3 vNormal;void main(void){gl_Position=uPMatrix* uMVMatrix * vec4(aVertexPosition, 1.0);vVertexNormal=(uNMatrix * vec4(aVertexNormal, 1.0)).rgb;vNormal=aVertexNormal;vTextureCoord=aTextureCoord;}</script><script>var startGame;setTimeout(function(){function Ft(){Jt=!0,setTimeout(Kt,10),C.setAttribute("class",""),k.setAttribute("class",""),O.style.display="block"}var e;(function(t){e=function(e){for($ in e)this.properties[$]!=undefined&&(this.properties[$]=e[$]);this.properties.rseed=this.properties.seed,this.root=new n([0,this.properties.u,0]),this.root.length=this.properties.e,this.verts=[],this.faces=[],this.normals=[],this.UV=[],this.vertsTwig=[],this.normalsTwig=[],this.facesTwig=[],this.uvsTwig=[],this.root.split(null,null,this.properties),this.createForks(),this.createTwigs(),this.doFaces(),this.calcNormals()},e.prototype.properties={h:.8,i:.5,f:.85,g:1,j:2,s:.6,o:1.5,p:0,n:.25,q:2,r:.95,t:13,a:6,b:3,m:0,e:.85,u:2.5,k:0,l:0,c:.2,d:2,seed:10,rseed:10,random:function(e){return e||(e=this.rseed++),Math.abs(Math.cos(e+e*e))}},e.prototype.calcNormals=function(){var e=this.normals,t=this.faces,n=this.verts,r=[];for(var s=0;s<n.length;s++)r[s]=[];for(var s=0;s<t.length;s++){var l=t[s],c=o(i(a(n[l[1]],n[l[2]]),a(n[l[1]],n[l[0]])));r[l[0]].push(c),r[l[1]].push(c),r[l[2]].push(c)}for(var s=0;s<r.length;s++){var h=[0,0,0],p=r[s].length;for(var d=0;d<p;d++)h=f(h,u(r[s][d],1/p));e[s]=h}},e.prototype.doFaces=function(e){e||(e=this.root);var t=this.properties.a,n=this.faces,u=this.verts,f=this.UV;if(!e.parent){for(v=0;v<u.length;v++)f[v]=[0,0];var l=o(i(a(e.child0.head,e.head),a(e.child1.head,e.head))),h=o(e.head),p=Math.acos(r(l,[-1,0,0]));r(i([-1,0,0],l),h)>0&&(p=2*Math.PI-p);var d=Math.round(p/Math.PI/2*t);for(var v=0;v<t;v++){var m=e.ring0[v],g=e.root[(v+d+1)%t],y=e.root[(v+d)%t],b=e.ring0[(v+1)%t];n.push([m,b,y]),n.push([b,g,y]),f[(v+d)%t]=[Math.abs(v/t-.5)*2,0];var w=s(a(u[e.ring0[v]],u[e.root[(v+d)%t]]))*this.properties.c;f[e.ring0[v]]=[Math.abs(v/t-.5)*2,w],f[e.ring2[v]]=[Math.abs(v/t-.5)*2,w]}}if(e.child0.ring0){var E,S,x,T,m=o(a(u[e.ring1[0]],e.head)),g=o(a(u[e.ring2[0]],e.head));m=c(m,o(a(e.child0.head,e.head)),0),g=c(g,o(a(e.child1.head,e.head)),0);for(var v=0;v<t;v++){var N=o(a(u[e.child0.ring0[v]],e.child0.head)),C=r(N,m);if(E==undefined||C>x)x=C,E=t-v;var N=o(a(u[e.child1.ring0[v]],e.child1.head)),C=r(N,g);if(S==undefined||C>T)T=C,S=t-v}var k=this.properties.n/e.radius;for(var v=0;v<t;v++){var m=e.child0.ring0[v],g=e.ring1[(v+E+1)%t],y=e.ring1[(v+E)%t],b=e.child0.ring0[(v+1)%t];n.push([m,b,y]),n.push([b,g,y]),m=e.child1.ring0[v],g=e.ring2[(v+S+1)%t],y=e.ring2[(v+S)%t],b=e.child1.ring0[(v+1)%t],n.push([m,g,y]),n.push([m,b,g]);var L=s(a(u[e.child0.ring0[v]],u[e.ring1[(v+E)%t]]))*k,A=f[e.ring1[(v+E-1)%t]];f[e.child0.ring0[v]]=[A[0],A[1]+L*this.properties.c],f[e.child0.ring2[v]]=[A[0],A[1]+L*this.properties.c];var O=s(a(u[e.child1.ring0[v]],u[e.ring2[(v+S)%t]]))*k,M=f[e.ring2[(v+S-1)%t]];f[e.child1.ring0[v]]=[M[0],M[1]+O*this.properties.c],f[e.child1.ring2[v]]=[M[0],M[1]+O*this.properties.c]}this.doFaces(e.child0),this.doFaces(e.child1)}else for(var v=0;v<t;v++){n.push([e.child0.end,e.ring1[(v+1)%t],e.ring1[v]]),n.push([e.child1.end,e.ring2[(v+1)%t],e.ring2[v]]);var w=s(a(u[e.child0.end],u[e.ring1[v]]));f[e.child0.end]=[Math.abs(v/t-1-.5)*2,w*this.properties.c];var w=s(a(u[e.child1.end],u[e.ring2[v]]));f[e.child1.end]=[Math.abs(v/t-.5)*2,w*this.properties.c]}},e.prototype.createTwigs=function(e){e||(e=this.root);var t=this.vertsTwig,n=this.normalsTwig,r=this.facesTwig,s=this.uvsTwig;if(!e.child0){var l=o(i(a(e.parent.child0.head,e.parent.head),a(e.parent.child1.head,e.parent.head))),c=o(a(e.head,e.parent.head)),h=i(l,c),p=t.length;t.push(f(f(e.head,u(l,this.properties.d)),u(c,this.properties.d*2-e.length)));var d=t.length;t.push(f(f(e.head,u(l,-this.properties.d)),u(c,this.properties.d*2-e.length)));var v=t.length;t.push(f(f(e.head,u(l,-this.properties.d)),u(c,-e.length)));var m=t.length;t.push(f(f(e.head,u(l,this.properties.d)),u(c,-e.length)));var g=t.length;t.push(f(f(e.head,u(l,this.properties.d)),u(c,this.properties.d*2-e.length)));var y=t.length;t.push(f(f(e.head,u(l,-this.properties.d)),u(c,this.properties.d*2-e.length)));var b=t.length;t.push(f(f(e.head,u(l,-this.properties.d)),u(c,-e.length)));var w=t.length;t.push(f(f(e.head,u(l,this.properties.d)),u(c,-e.length))),r.push([p,d,v]),r.push([m,p,v]),r.push([b,y,g]),r.push([b,g,w]),h=o(i(a(t[p],t[v]),a(t[d],t[v]))),normal2=o(i(a(t[y],t[b]),a(t[g],t[b]))),n.push(h),n.push(h),n.push(h),n.push(h),n.push(normal2),n.push(normal2),n.push(normal2),n.push(normal2),s.push([0,1]),s.push([1,1]),s.push([1,0]),s.push([0,0]),s.push([0,1]),s.push([1,1]),s.push([1,0]),s.push([0,0])}else this.createTwigs(e.child0),this.createTwigs(e.child1)},e.prototype.createForks=function(e,t){e||(e=this.root),t||(t=this.properties.n),e.radius=t,t>e.length&&(t=e.length);var n=this.verts,h=this.properties.a,p=Math.PI*2/h;if(!e.parent){e.root=[];var d=[0,1,0];for(var v=0;v<h;v++){var m=l([-1,0,0],d,-p*v);e.root.push(n.length),n.push(u(m,t/this.properties.s))}}if(e.child0){if(e.parent)var d=o(a(e.head,e.parent.head));else var d=o(e.head);var g=o(a(e.head,e.child0.head)),y=o(a(e.head,e.child1.head)),b=o(i(g,y));e.tangent=b;var w=o(i(b,o(f(u(g,-1),u(y,-1))))),E=[y[0],0,y[2]],S=f(e.head,u(E,-this.properties.n/2)),x=e.ring0=[],T=e.ring1=[],N=e.ring2=[],C=this.properties.s;if(e.child0.type=="trunk"||e.type=="trunk")C=1/this.properties.r;var k=n.length;x.push(k),N.push(k),n.push(f(S,u(b,t*C)));var L=n.length-1,A=l(b,y,1.57),O=o(i(b,d)),M=1/r(A,O);for(var v=1;v<h/2;v++){var m=l(b,y,p*v);x.push(L+v),N.push(L+v),m=c(m,O,M),n.push(f(S,u(m,t*C)))}var _=n.length;x.push(_),T.push(_),n.push(f(S,u(b,-t*C)));for(var v=h/2+1;v<h;v++){var m=l(b,g,p*v);x.push(n.length),T.push(n.length),n.push(f(S,u(m,t*C)))}T.push(k),N.push(_);var L=n.length-1;for(var v=1;v<h/2;v++){var m=l(b,w,p*v);T.push(L+v),N.push(L+(h/2-v));var D=u(m,t*C);n.push(f(S,D))}var P=s(a(e.head,e.child0.head)),H=s(a(e.head,e.child1.head)),B=1*t*this.properties.s,j=1*t*this.properties.s;e.child0.type=="trunk"&&(B=t*this.properties.r),this.createForks(e.child0,B),this.createForks(e.child1,j)}else e.end=n.length,n.push(e.head)};var n=function(e,t){this.head=e,this.parent=t};n.prototype.child0=null,n.prototype.child1=null,n.prototype.parent=null,n.prototype.head=null,n.prototype.length=1,n.prototype.mirrorBranch=function(e,t,n){var s=i(t,i(e,t)),o=n.j*r(s,e);return[e[0]-s[0]*o,e[1]-s[1]*o,e[2]-s[2]*o]},n.prototype.split=function(e,t,r,s,l){s==undefined&&(s=1),l==undefined&&(l=1),e==undefined&&(e=r.b),t==undefined&&(t=r.q);var c=r.b-e,h;this.parent?h=this.parent.head:(h=[0,0,0],this.type="trunk");var p=this.head,d=o(a(p,h)),v=i(d,[d[2],d[0],d[1]]),m=i(d,v),g=r.random(c*10+s*5+l+r.seed),y=r.random(c*10+s*5+l+1+r.seed),b=r.h,w=r.i,E=f(u(v,g),u(m,1-g));g>.5&&(E=u(E,-1));var S=(b-w)*g+w,x=o(f(u(E,1-S),u(d,S))),T=this.mirrorBranch(x,d,r);if(g>.5){var N=x;x=T,T=N}if(t>0){var C=t/r.q*2*Math.PI*r.t;T=o([Math.sin(C),g,Math.cos(C)])}var k=e*e/(r.b*r.b)*r.l,L=c*r.k,A=c*r.m;x=o(f(x,[A,L+k,0])),T=o(f(T,[A,L+k,0]));var O=f(p,u(x,this.length)),M=f(p,u(T,this.length));this.child0=new n(O,this),this.child1=new n(M,this),this.child0.length=Math.pow(this.length,r.g)*r.f,this.child1.length=Math.pow(this.length,r.g)*r.f,e>0&&(t>0?(this.child0.head=f(this.head,[(g-.5)*2*r.p,r.o,(g-.5)*2*r.p]),this.child0.type="trunk",this.child0.length=this.length*r.r,this.child0.split(e,t-1,r,s+1,l)):this.child0.split(e-1,0,r,s+1,l),this.child1.split(e-1,0,r,s,l+1))};var r=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]},i=function(e,t){return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]},s=function(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2])},o=function(e){var t=s(e);return u(e,1/t)},u=function(e,t){return[e[0]*t,e[1]*t,e[2]*t]},a=function(e,t){return[e[0]-t[0],e[1]-t[1],e[2]-t[2]]},f=function(e,t){return[e[0]+t[0],e[1]+t[1],e[2]+t[2]]},l=function(e,t,n){var s=Math.cos(n),o=Math.sin(n);return f(f(u(e,s),u(i(t,e),o)),u(t,r(t,e)*(1-s)))},c=function(e,t,n){var i=r(e,t),s=u(t,i*n-i);return f(e,s)}})(window);var t=function(e){var t=document.createElement("canvas");t.height=t.width=e.size;var n=t.getContext("2d"),r=e.seed,i=function(){return r++,r=r*r*255%128/128,r},s=n.createImageData(e.size,e.size),o=e.size*e.size*4;for(var u=0;u<o;u+=4){var a=255*(i()+e.minIntensity);s.data[u]=a*e.r,s.data[u+1]=a*e.g,s.data[u+2]=a*e.b,s.data[u+3]=255}n.putImageData(s,0,0),n.globalAlpha=e.lineAlpha;for(var u=0;u<e.lines;u++){n.beginPath(),n.lineWidth=(i()+e.minLine)*e.lineWidth;var a=255*(i()+e.minIntensity);n.strokeStyle="rgb("+a+","+a+","+a+")";var f=i()*e.size,l=i()*e.size,c=f+(i()-.5)*e.size*e.xbias,h=l+(i()-.5)*e.size*e.ybias;n.moveTo(f,l),n.lineTo(c,h),n.stroke()}n.globalAlpha=e.blurAlpha;var p=function(r){var s=-(r-e.size)*.5*i();n.drawImage(t,0,0,e.size,e.size,s*e.xbias,s*e.ybias,r*e.xbias,r*e.ybias)};for(var u=2;u<e.blurb+2;u++)p(u*e.size);return t},n=function(e){var t,n,r,i,s=e.getContext("2d"),o=e.width,u=e.height,a=s.getImageData(0,0,o,u),f=s.createImageData(o,u),l=s.createImageData(o,u);for(var c=0;c<2;c++)for(var h=0;h<o;h++)for(var p=0;p<u;p++)c?(t=Math.min(Math.abs(p-u),p),n=Math.sqrt(Math.min(1,t/u*2)),i=((p+u*.5)%u*o+h)*4,dataDst=l.data,dataSrc=f.data):(t=Math.min(Math.abs(h-o),h),n=Math.sqrt(Math.min(1,t/o*2)),i=(p*o+(h+o*.5)%o)*4,dataDst=f.data,dataSrc=a.data),r=(p*o+h)*4,dataDst[r]=dataSrc[r]*n+dataSrc[i]*(1-n),dataDst[r+1]=dataSrc[r+1]*n+dataSrc[i+1]*(1-n),dataDst[r+2]=dataSrc[r+2]*n+dataSrc[i+2]*(1-n),dataDst[r+3]=255;return s.putImageData(l,0,0),e},r=function(e){var t=document.createElement("canvas");t.height=512,t.width=512;var n=t.getContext("2d"),r=512,i=13,s=.3,o=r/i,u=r/i,a=r/i*.8,f=.9015853619202971,l=function(){return f++,f=f*f*255%128/128,f},c=function(t,r,f){for(var h=t;h<i;h++){var p=[f[0]+(l()-.5)*1.5,f[1]+(l()-.5)*1.5],d=Math.sqrt(p[0]*p[0]+p[1]*p[1]);p[0]/=d,p[1]/=d;if(l()>.5&&h!=t)c(h,[r[0],r[1]],p);else if(h>i*.5){n.beginPath(),n.fillStyle=e[Math.floor(l()*e.length)];var v=r[0]+p[0]*u,m=r[1]+p[1]*u,g=r[0]+p[0]*u*.5+p[1]*a,y=r[1]+p[1]*u*.5-p[0]*a,b=r[0]+p[0]*u*.5-p[1]*a,w=r[1]+p[1]*u*.5+p[0]*a;n.moveTo(r[0],r[1]),n.quadraticCurveTo(g,y,v,m),n.quadraticCurveTo(b,w,v,m),n.closePath(),n.fill()}n.beginPath(),n.lineWidth=s*(i-h),n.moveTo(r[0],r[1]),r[0]+=f[0]*o,r[1]+=f[1]*o,n.lineTo(r[0],r[1]),n.stroke()}},h=[t.width/2,t.height],p=[0,-1],d=1;return c(d,h,p),t},i=function(){var e=document.createElement("canvas");e.height=e.width=256;var t=e.getContext("2d"),n=.3015853619202971,r=function(){return n++,n=n*n*255%128/128,n};for(var i=0;i<100;i++)t.beginPath(),t.strokeStyle=r()>.8?"#f02":"#ff2",t.moveTo(r()*100+100,250-r()*200),t.lineTo(r()*100+100,250-r()*200),t.stroke();t.globalAlpha=.15;for(var i=0;i<20;i++)t.drawImage(e,0,0,256,256,-10+Math.cos(i)*5,-12,270,270);return e},s=function(){var e={size:512,xbias:1,ybias:1,r:.58,g:.58,b:.5,minIntensity:.2,lineAlpha:.5,blurAlpha:.5,minLine:1,lineWidth:5,lines:100,blurb:3,seed:.31093138875439763};return t(e)},o=function(){var e=s(),t=document.createElement("canvas");t.width=t.height=512;var n=t.getContext("2d");n.drawImage(e,0,0);var r=n.getImageData(0,0,512,512);for(var i=0;i<512;i++)for(var o=0;o<512;o++){var u=(o*512+i)*4,a=i-256,f=o-320,l=Math.sqrt(a*a+f*f)/320;l=Math.pow(l,10)+.02,r.data[u+3]=Math.round(l*255)}return n.putImageData(r,0,0),t},u;(function(){var e=.9015853619202971,t=function(){return e++,e=e*e*255%128/128,e};u=function(e){for($ in e)this[$]=e[$];this.trackPoints=this.generateTrackPoints(),this.interPoints=this.generateTrackInterPoints(this.numTrackInterPoints),this.randomData=this.generateRandomData(),this.heightMap=this.generateHeightMap(),this.terrainMesh=this.generateTerrainMesh()},u.prototype.numTrackPoints=42,u.prototype.numTrackInterPoints=150,u.prototype.terrainSize=300,u.prototype.height=1,u.prototype.trackSize=220,u.prototype.trackDiv=.75,u.prototype.trackWidth=2,u.prototype.trackFalloffDistance=15,u.prototype.trackHeightMin=3.5,u.prototype.trackHeightMax=4.5,u.prototype.generateTrackPoints=function(){var e=[],n=this.numTrackPoints,r=this.trackHeightMax-this.trackHeightMin,i=0,s=0,o=0;for(var u=0;u<n;u++)if(u-i>2&&t()>.5){var a=u/(n*.5)*Math.PI,f=t()*this.trackSize/2*this.trackDiv+this.trackSize/2*(1-this.trackDiv);e.push([Math.sin(a)*f+this.terrainSize/2,Math.cos(a)*f+this.terrainSize/2,t()*r+this.trackHeightMin]),i=u,o=f}return e},u.prototype.generateRandomData=function(){var e=[];for(var n=0;n<8;n++){e[n]=[];for(var r=0;r<8;r++)e[n][r]=t()}return e},u.prototype.generateTrackInterPoints=function(e){var t=[];for(var n=0;n<e;n++)t.push(this.curvePoint(n/e));return t},u.prototype.cubicInterpolate=function(e,t,n,r,i){var s,o,u,a,f;return f=i*i,s=r-n-e+t,o=e-t-s,u=n-e,a=t,s*i*f+o*f+u*i+a},u.prototype.curvePoint=function(e){var t=this.trackPoints,n=e*t.length,r=Math.floor(n);e=n%1;var i=(r+t.length-1)%t.length,s=r,o=(r+1)%t.length,u=(r+2)%t.length,a=this.cubicInterpolate(t[i][0],t[s][0],t[o][0],t[u][0],e),f=this.cubicInterpolate(t[i][1],t[s][1],t[o][1],t[u][1],e),l=this.cubicInterpolate(t[i][2],t[s][2],t[o][2],t[u][2],e);return[a,f,l]},u.prototype.distanceFromSegment=function(e,t,n){var r=[e[0]-t[0],e[1]-t[1]],i=[e[0]-n[0],e[1]-n[1]],s=[n[0]-t[0],n[1]-t[1]],o=Math.sqrt(r[0]*r[0]+r[1]*r[1]),u=Math.sqrt(i[0]*i[0]+i[1]*i[1]),a=Math.sqrt(s[0]*s[0]+s[1]*s[1]),f=[s[0]/a,s[1]/a],l=f[0]*r[0]+f[1]*r[1],c=l>0,h=f[0]*i[0]+f[1]*i[1]<0,p,d;if(c&&h){p=Math.abs(f[1]*r[0]-f[0]*r[1]);var v=l/a;d=this.mix(t[2],n[2],v)}else c?(p=u,d=n[2]):(p=o,d=t[2]);return[p,d]},u.prototype.distanceFromTrack=function(e,t){var n=1e4,r=0,i=[e,t],s=this.interPoints;for(var o=0;o<s.length;o++){var u=s[o],a=s[(o+1)%s.length],f=this.distanceFromSegment(i,a,u);f[0]<n&&(n=f[0],r=f[1])}return[n,r]},u.prototype.mix=function(e,t,n){return e*(1-n)+t*n},u.prototype.clamp=function(e,t,n){return Math.max(e,Math.min(t,n))},u.prototype.sampleAt=function(e,t){var n=this.randomData,r=Math.floor(e%8),i=Math.floor(t%8);try{return this.mix(this.mix(n[r][i],n[r][(i+1)%8],t%1),this.mix(n[(r+1)%8][i],n[(r+1)%8][(i+1)%8],t%1),e%1)}catch(s){return 0}},u.prototype.heightAt=function(e,t){var n=Math.min(Math.abs(e-this.terrainSize),Math.abs(t-this.terrainSize),e,t);n=Math.sqrt(Math.max(0,7-n)*5);var r=this.distanceFromTrack(e,t);e/=.5*this.terrainSize,t/=.5*this.terrainSize;var i=this.sampleAt(e*2,t*2)/2+this.sampleAt(e*3,t*3)/4+this.sampleAt(e*5,t*5)/8+this.sampleAt(e*13,t*13)/16+this.sampleAt(e*19,t*19)/16;i=i*i*1.5*this.height,i=Math.min(this.height,i);var s=(this.clamp(this.trackWidth,this.trackFalloffDistance,r[0])-this.trackWidth)/(this.trackFalloffDistance-this.trackWidth);return this.mix(i,r[1],Math.pow(1-s,4))+n},u.prototype.generateHeightMap=function(){var e=this.terrainSize,t=[];for(var n=0;n<e;n++){t[n]=[];for(var r=0;r<e;r++)t[n][r]=this.heightAt(n,r)}return t},u.prototype.generateTerrainMesh=function(){var e=this.terrainSize,t=[],n=[];for(var r=0;r<e;r++)for(var i=0;i<e;i++)t.push(r,i,this.heightMap[r][i]),n.push(r,i);var s=[];for(var r=0;r<e-1;r++)for(var i=0;i<e-1;i++){var o=r*e+i,u=r*e+i+1,a=(r+1)*e+i,f=(r+1)*e+i+1;s.push(o,a,f,o,f,u)}var l=[];for(var c=0;c<t.length;c++)l.push(0);for(var c=0;c<s.length;c++){var h=s[c*3]*3,p=s[c*3+1]*3,d=s[c*3+2]*3,v=t[p]-t[h],m=t[d]-t[h],g=t[p+1]-t[h+1],y=t[d+1]-t[h+1],b=t[p+2]-t[h+2],w=t[d+2]-t[h+2],E=g*w-b*y,S=b*m-v*w,x=v*y-g*m;l[h]+=E,l[p]+=E,l[d]+=E,l[h+1]+=S,l[p+1]+=S,l[d+1]+=S,l[h+2]+=x,l[p+2]+=x,l[d+2]+=x}for(var c=0;c<l.length;c+=3){var E=l[c],S=l[c+1],x=l[c+2],T=Math.sqrt(E*E+S*S+x*x);l[c]/=T,l[c+1]/=T,l[c+2]/=T}return{verts:t,faces:s,uvs:n,normals:l}}})();var a=function(e,t,n,r,i,s,o){var u=2*i/(t-e),a=2*i/(r-n),f=(t+e)/(t-e),l=(r+n)/(r-n),c=-(s+i)/(s-i),h=-2*s*i/(s-i);return g(u,0,f,0,0,a,l,0,0,0,c,h,0,0,-1,0,o)},f=function(e,t,n,r,i){var s=n*Math.tan(e*.00872664625972),o=-s,u=o*t,f=s*t;return a(u,f,o,s,n,r,i)},l=0,c=function(){var e=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);return l=(l+1)%1e5,e.unique=l,e},h=function(e,t,n,r){return g(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1,r)},p=function(e,t,n,r){return g(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1,r)},d=function(e,t,n){var r,i,s,o,u,a,f,l,c;t=[t[0],t[1],t[2],0];var h=t[0],p=t[1],d=t[2],v=Math.cos(e),m=1-v,y=Math.sin(e);return f=h*y,l=p*y,c=d*y,r=h*h,i=p*p,s=d*d,o=h*p,u=p*d,a=d*h,g(m*r+v,m*o-c,m*a+l,0,m*o+c,m*i+v,m*u-f,0,m*a-l,m*u+f,m*s+v,0,0,0,0,1,n)},v=function(){var e=c(),t=c(),n=c();return function(r,i,s,o,u,a,f,l,c){return h(r,i,s,e),d(f,l,t),y(e,t,n),y(n,p(o,u,a,e),c),c}}(),m=function(e){var t=e[1];e[1]=e[4],e[4]=t;var t=e[8];e[8]=e[2],e[2]=t;var t=e[3];e[3]=e[12],e[12]=t;var t=e[9];e[9]=e[6],e[6]=t;var t=e[13];e[13]=e[7],e[7]=t;var t=e[14];return e[14]=e[11],e[11]=t,l=(l+1)%1e5,e.unique=l,e},g=function(e,t,n,r,i,s,o,u,a,f,c,h,p,d,v,m,g){return g[0]=e,g[1]=t,g[2]=n,g[3]=r,g[4]=i,g[5]=s,g[6]=o,g[7]=u,g[8]=a,g[9]=f,g[10]=c,g[11]=h,g[12]=p,g[13]=d,g[14]=v,g[15]=m,l=(l+1)%1e5,g.unique=l,g},y=function(e,t,n){var r=t[0],i=t[1],s=t[2],o=t[3],u=t[4],a=t[5],f=t[6],l=t[7],c=t[8],h=t[9],p=t[10],d=t[11],v=t[12],m=t[13],y=t[14],b=t[15],w=e[0],E=e[1],S=e[2],x=e[3],T=e[4],N=e[5],C=e[6],k=e[7],L=e[8],A=e[9],O=e[10],M=e[11],_=e[12],D=e[13],P=e[14],H=e[15];return g(w*r+E*u+S*c+x*v,w*i+E*a+S*h+x*m,w*s+E*f+S*p+x*y,w*o+E*l+S*d+x*b,T*r+N*u+C*c+k*v,T*i+N*a+C*h+k*m,T*s+N*f+C*p+k*y,T*o+N*l+C*d+k*b,L*r+A*u+O*c+M*v,L*i+A*a+O*h+M*m,L*s+A*f+O*p+M*y,L*o+A*l+O*d+M*b,_*r+D*u+P*c+H*v,_*i+D*a+P*h+H*m,_*s+D*f+P*p+H*y,_*o+D*l+P*d+H*b,n)},b=function(e,t){var n=e[0],r=e[1],i=e[2],s=e[3],o=e[4],u=e[5],a=e[6],f=e[7],l=e[8],c=e[9],h=e[10],p=e[11],d=e[12],v=e[13],m=e[14],y=e[15],b=d*c*a*s-l*v*a*s-d*u*h*s+o*v*h*s+l*u*m*s-o*c*m*s-d*c*i*f+l*v*i*f+d*r*h*f-n*v*h*f-l*r*m*f+n*c*m*f+d*u*i*p-o*v*i*p-d*r*a*p+n*v*a*p+o*r*m*p-n*u*m*p-l*u*i*y+o*c*i*y+l*r*a*y-n*c*a*y-o*r*h*y+n*u*h*y;return g((c*m*f-v*h*f+v*a*p-u*m*p-c*a*y+u*h*y)/b,(v*h*s-c*m*s-v*i*p+r*m*p+c*i*y-r*h*y)/b,(u*m*s-v*a*s+v*i*f-r*m*f-u*i*y+r*a*y)/b,(c*a*s-u*h*s-c*i*f+r*h*f+u*i*p-r*a*p)/b,(d*h*f-l*m*f-d*a*p+o*m*p+l*a*y-o*h*y)/b,(l*m*s-d*h*s+d*i*p-n*m*p-l*i*y+n*h*y)/b,(d*a*s-o*m*s-d*i*f+n*m*f+o*i*y-n*a*y)/b,(o*h*s-l*a*s+l*i*f-n*h*f-o*i*p+n*a*p)/b,(l*v*f-d*c*f+d*u*p-o*v*p-l*u*y+o*c*y)/b,(d*c*s-l*v*s-d*r*p+n*v*p+l*r*y-n*c*y)/b,(o*v*s-d*u*s+d*r*f-n*v*f-o*r*y+n*u*y)/b,(l*u*s-o*c*s-l*r*f+n*c*f+o*r*p-n*u*p)/b,(d*c*a-l*v*a-d*u*h+o*v*h+l*u*m-o*c*m)/b,(l*v*i-d*c*i+d*r*h-n*v*h-l*r*m+n*c*m)/b,(d*u*i-o*v*i-d*r*a+n*v*a+o*r*m-n*u*m)/b,(o*c*i-l*u*i+l*r*a-n*c*a-o*r*h+n*u*h)/b,t)};window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)}}();var w=function(e){return P=e.getContext("experimental-webgl"),P.viewportWidth=e.width,P.viewportHeight=e.height,P||alert("No Webgl"),P},E=function(e,t,n){this.gl=e;var r=e.createProgram(),i=this.createShader(e,t,e.VERTEX_SHADER),s=this.createShader(e,n,e.FRAGMENT_SHADER);if(i==null||s==null)return null;e.attachShader(r,i),e.attachShader(r,s),e.deleteShader(i),e.deleteShader(s),e.linkProgram(r),this.uniforms=[],this.uniformNames={};var o=e.getProgramParameter(r,e.ACTIVE_UNIFORMS);for(var u=0;u<o;u++){var a=e.getActiveUniform(r,u);a.location=e.getUniformLocation(r,a.name),this.uniforms.push(a),this.uniformNames[a.name]=a}this.attributes=[];var f=e.getProgramParameter(r,e.ACTIVE_ATTRIBUTES),l=0;for(var u=0;u<f;u++){var a=e.getActiveAttrib(r,u);a.location=e.getAttribLocation(r,a.name),a.offset=l,a.num=a.type==e.FLOAT_VEC3?3:a.type==e.FLOAT_VEC4?4:2,l+=a.num,this.attributes.push(a),e.enableVertexAttribArray(a.location)}this.totalStride=l*4,this.totalOffset=l,this.uniformCache={},this.program=r};E.prototype.createShader=function(e,t,n){var r=e.createShader(n);return e.shaderSource(r,t),e.compileShader(r),e.getShaderParameter(r,e.COMPILE_STATUS)?r:(console.log((n==e.VERTEX_SHADER?"VERTEX":"FRAGMENT")+" SHADER:\n"+e.getShaderInfoLog(r)),null)},E.prototype.setUniform=function(e,t){var n=t;n.length&&(n=t.unique);if(this.uniformCache[e]!=n||isNaN(n))loc=this.uniformNames[e].location,this.uniformNames[e].type==P.FLOAT_MAT4?P.uniformMatrix4fv(loc,!1,t):this.uniformNames[e].type==P.SAMPLER_2D?P.uniform1i(loc,t):this.uniformNames[e].type==P.FLOAT&&P.uniform1f(loc,t),this.uniformCache[e]=n};var S=function(e,t,n){this.data=t;var r=e.createBuffer();e.bindBuffer(e[n],r),e.bufferData(e[n],t,e.STATIC_DRAW),this.buffer=r};S.prototype.offsets={aVertexPosition:0,aVertexNormal:12,aTextureCoord:24};var x=function(e){this.gl=e,e.clearColor(.3,.4,.5,1),e.enable(e.DEPTH_TEST),this.clear()};x.prototype.useProgram=function(e){var t=this.gl;e!=t.program&&(t.program=e,this.program=e,t.useProgram(e.program))},x.prototype.useBuffer=function(e){if(this.buffer!=e){var t=this.gl;t.bindBuffer(t.ARRAY_BUFFER,e.buffer);if(this.program){var n=this.program.attributes,r=n.length;for(var i=0;i<r;i++)t.vertexAttribPointer(n[i].location,n[i].num,t.FLOAT,!1,this.program.totalStride,e.offsets[n[i].name])}}},x.prototype.useElements=function(e){if(e!=this.elementsBuffer){var t=this.gl;this.elementsBuffer=e,t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,e.buffer)}},x.prototype.drawElements=function(){var e=this.gl;e.drawElements(e.TRIANGLES,this.elementsBuffer.data.length,e.UNSIGNED_SHORT,0)},x.prototype.setUniform=function(e,t){var n=this.gl,r=this.program;r.setUniform(e,t)},x.prototype.clear=function(){var e=this.gl;e.viewport(0,0,e.viewportWidth,e.viewportHeight),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT)},x.prototype.addTexture=function(e,t){var n=this.gl,r=n.createTexture();n.activeTexture(n["TEXTURE"+e]),n.bindTexture(n.TEXTURE_2D,r),n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,!0),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,t),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR_MIPMAP_LINEAR),n.generateMipmap(n.TEXTURE_2D)};var T=document.getElementById("bar"),N=document.getElementById("intro"),C=document.getElementById("startgame"),k=document.getElementById("underlay"),L=document.getElementById("smotenum"),A=document.getElementById("bi"),O=document.getElementById("gameover");A.style.backgroundImage=N.style.backgroundImage="url("+s().toDataURL()+")";var M=document.getElementById("overlay");M.style.backgroundImage="url('"+o().toDataURL()+"')";var _=function(){this.position=[125,10,-125],this.rotation=[0,0],this.transMat=c(),this.rotMat1=c(),this.rotMat2=c(),this.temp=c(),this.matrix=c(),this.invMatrix=c(),this.updateMatrix()};_.prototype.updateMatrix=function(){var e=this.position,t=this.rotation,n=this.transMat,r=this.temp,i=this.rotMat1,s=this.rotMat2;h(e[0],e[1],e[2],n),d(t[0],[1,0,0],i),d(t[1],[0,1,0],s),y(s,i,r),y(n,r,this.matrix),b(this.matrix,this.invMatrix)},_.prototype.rotateV=function(e){this.rotation[0]+=e,this.updateMatrix()},_.prototype.rotateH=function(e){this.rotation[1]+=e,this.updateMatrix()},_.prototype.move=function(e,t){this.position[0]+=this.matrix[0+e]*t,this.position[1]+=this.matrix[4+e]*t,this.position[2]+=this.matrix[8+e]*t,this.updateMatrix()};var D=document.getElementById("canvas");D.width=800,D.height=window.innerHeight/window.innerWidth*800;var P=w(D);P.cullFace(P.BACK),P.enable(P.CULL_FACE),P.blendFunc(P.SRC_ALPHA,P.ONE);var H=new e({seed:152,a:6,b:5,c:1.16,d:.44,e:.49,f:.85,g:.99,h:.454,i:.246,j:3.2,k:.09,l:.235,m:.01,n:.114,o:.41,p:0,q:5,r:.835,s:.73,t:2.06,u:2.5}),B=new e({seed:499,a:8,b:5,c:1,d:.48,e:.5,f:.98,g:1.08,h:.414,i:.282,j:2.2,k:.24,l:.044,m:0,n:.096,o:.39,p:0,q:5,r:.958,s:.71,t:2.97,u:1.95}),j=function(e){var t=[],n=e.verts.length;for(var r=0;r<n;r++)t.push(e.verts[r][0],e.verts[r][1],e.verts[r][2],e.normals[r][0],e.normals[r][1],e.normals[r][2],e.UV[r][0],e.UV[r][1]);var i=[];for(var r=0;r<e.faces.length;r++)i.push(e.faces[r][0],e.faces[r][1],e.faces[r][2]);var s=t.length/8,o=[],n=e.vertsTwig.length;for(var r=0;r<n;r++)t.push(e.vertsTwig[r][0],e.vertsTwig[r][1],e.vertsTwig[r][2],e.normalsTwig[r][0],e.normalsTwig[r][1],e.normalsTwig[r][2],e.uvsTwig[r][0]+50,e.uvsTwig[r][1]);for(var r=0;r<e.facesTwig.length;r++)i.push(e.facesTwig[r][0]+s,e.facesTwig[r][1]+s,e.facesTwig[r][2]+s);return[t,i]},F=j(H),I=j(B),q=new S(P,new Float32Array(F[0]),"ARRAY_BUFFER"),R=new S(P,new Uint16Array(F[1]),"ELEMENT_ARRAY_BUFFER"),U=new S(P,new Float32Array(I[0]),"ARRAY_BUFFER"),z=new S(P,new Uint16Array(I[1]),"ELEMENT_ARRAY_BUFFER"),W=new u({height:15,terrainSize:250}),X=W.terrainMesh.verts.length/3,V=[];for(var $=0;$<X;$++)V.push(W.terrainMesh.verts[$*3]),V.push(W.terrainMesh.verts[$*3+1]),V.push(W.terrainMesh.verts[$*3+2]),V.push(W.terrainMesh.normals[$*3]),V.push(W.terrainMesh.normals[$*3+1]),V.push(W.terrainMesh.normals[$*3+2]),V.push(W.terrainMesh.uvs[$*2]),V.push(W.terrainMesh.uvs[$*2+1]);var J=new S(P,new Float32Array(V),"ARRAY_BUFFER"),K=new S(P,new Uint16Array(W.terrainMesh.faces),"ELEMENT_ARRAY_BUFFER"),Q=new E(P,document.getElementById("shader-vs").innerHTML,document.getElementById("shader-fs").innerHTML),G=new E(P,document.getElementById("shader-vs").innerHTML,document.getElementById("shader-fs2").innerHTML),Y=new E(P,document.getElementById("particle-vs").innerHTML,document.getElementById("particle-fs").innerHTML),Z=m(f(45,1.6,.01,1e3,c())),et=c(),tt=c();v(0,0,0,1,1,1,-1.57,[1,0,0],tt);var nt=new x(P),rt={size:256,xbias:1,ybias:3,r:.46,g:.37,b:.32,minIntensity:-0.1,lineAlpha:.5,blurAlpha:.5,minLine:1,lineWidth:5,lines:50,blurb:2,seed:.22342867101542652},it={size:512,xbias:1,ybias:1,r:.14,g:.33,b:.13,minIntensity:.2,lineAlpha:.5,blurAlpha:.5,minLine:1,lineWidth:2,lines:0,blurb:3,seed:.6985204408410937},st={size:512,xbias:1,ybias:1,r:.42,g:.38,b:.26,minIntensity:.2,lineAlpha:.5,blurAlpha:.5,minLine:1,lineWidth:5,lines:100,blurb:3,seed:.31093138875439763},ot={size:512,xbias:1.2,ybias:1,r:.5,g:.7,b:.7,minIntensity:0,lineAlpha:.6,blurAlpha:.75,minLine:1,lineWidth:20,lines:50,blurb:3,seed:.8831543794367462};nt.addTexture(0,n(t(rt))),nt.addTexture(1,r(["rgba(0,36,0,1)","rgba(25,36,12,1)","rgba(36,36,0,1)"])),nt.addTexture(2,n(t(ot))),nt.addTexture(3,n(t(st))),nt.addTexture(4,n(t(it))),nt.addTexture(5,r(["rgba(25,36,0,1)","rgba(50,36,12,1)","rgba(65,36,0,1)"])),rt.r=.4,rt.g=.4,rt.b=.36,nt.addTexture(6,n(t(rt))),nt.addTexture(7,i());var ut=new Image;ut.onload=function(){nt.addTexture(8,ut)},ut.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQBAMAAADt3eJSAAAAAXNSR0IArs4c6QAAABhQTFRFDA4KLS4sVldVZ2lmjY+Ms7Wy1NbT+fv4geR4pwAAAF1JREFUCNdjKIcCBiAOK4UwUlWL3UGMFEO2QiFXICNIQLyIQQXIKDFOL3d2AyuG6kpLKytLSwMyytLLQRgklZoOMafUwTkczChTdEiHWGHkCLXLOQgiVZ6aCpUCAwBYHTQLXnC3gQAAAABJRU5ErkJggg==",nt.useProgram(Q),nt.setUniform("uPMatrix",Z),nt.useProgram(Y),nt.setUniform("uPMatrix",Z),nt.setUniform("texture1",7),nt.useProgram(G),nt.setUniform("uPMatrix",Z),nt.setUniform("texture1",2),nt.setUniform("texture2",3),nt.setUniform("texture3",4);var at=new _,ft=c(),lt=c(),ct=[],ht=[];for(var $=0;$<500;$++){var pt=Math.floor(Math.random()*250),dt=-Math.floor(Math.random()*250),vt=W.heightAt(pt,-dt),mt=c(),gt=Math.random()*1.5+.9;v(pt,vt,dt,gt,gt,gt,Math.random()*Math.PI*2,[0,1,0],mt),ct.push({idx:$,mat:mt}),ht.push({idx:$,mv:c(),mn:c()})}var yt=.04,bt=1.58,wt=.85,Et=.53,St=[bt,yt,-yt,-wt,-Et,0,55,1,bt,yt,yt,-wt,-Et,0,56,1,1.45,.24,-0.01,-wt,-Et,0,56,0,bt,-yt,-yt,-0.88,.47,0,55,1,1.45,-0.27,-0.01,-0.88,.47,0,56,1,bt,-yt,yt,-0.88,.47,0,56,0,bt,yt,yt,.09,.26,.96,55,1,2.07,0,.01,.09,.26,.96,56,1,1.45,.24,-0.01,.09,.26,.96,56,0,bt,yt,yt,.07,0,1,55,1,bt,-yt,yt,.07,0,1,56,1,2.07,0,.01,.07,0,1,56,0,bt,-yt,yt,.08,-0.24,.97,55,1,1.45,-0.27,-0.01,.08,-0.24,.97,56,1,2.07,0,.01,.08,-0.24,.97,56,0,bt,yt,-yt,.09,0,-1,55,1,2.07,0,.01,.09,0,-1,56,1,bt,-yt,-yt,.09,0,-1,56,0,bt,yt,-yt,.1,.21,-0.97,55,1,1.45,.24,-0.01,.1,.21,-0.97,56,1,2.07,0,.01,.1,.21,-0.97,56,0,bt,-yt,-yt,.1,-0.16,-1,55,1,2.07,0,.01,.1,-0.16,-1,56,1,1.45,-0.27,-0.01,.1,-0.16,-1,56,0,bt,yt,yt,0,1,0,0,1,bt,yt,-yt,0,1,0,1,1,-bt,yt,yt,0,1,0,0,0,-bt,yt,-yt,0,1,0,1,0,-bt,-yt,-yt,-1,0,0,0,1,-bt,-yt,yt,-1,0,0,1,1,-bt,yt,yt,-1,0,0,1,0,-bt,yt,-yt,-1,0,0,0,0,bt,-yt,-yt,0,-1,0,0,1,bt,-yt,yt,0,-1,0,1,1,-bt,-yt,-yt,0,-1,0,0,0,-bt,-yt,yt,0,-1,0,1,0,bt,yt,yt,0,0,1,0,1,-bt,yt,yt,0,0,1,1,1,bt,-yt,yt,0,0,1,0,0,-bt,-yt,yt,0,0,1,1,0,bt,yt,-yt,0,0,-1,0,1,bt,-yt,-yt,0,0,-1,1,1,-bt,yt,-yt,0,0,-1,0,0,-bt,-yt,-yt,0,0,-1,1,0],xt=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,25,27,26,28,29,30,28,30,31,32,33,34,33,35,34,36,37,38,37,39,38,40,41,42,41,43,42],Tt=new S(P,new Float32Array(St),"ARRAY_BUFFER"),Nt=new S(P,new Uint16Array(xt),"ELEMENT_ARRAY_BUFFER"),Ct=c(),kt=c(),Lt=c(),At=new S(P,new Float32Array([-0.3,-0.3,0,0,0,1,0,0,.3,-0.3,0,0,0,1,1,0,.3,.3,0,0,0,1,1,1,-0.3,.3,0,0,0,1,0,1]),"ARRAY_BUFFER"),Ot=new S(P,new Uint16Array([0,3,1,1,3,2]),"ELEMENT_ARRAY_BUFFER"),Mt=100,_t=[],Dt=[];for(var $=0;$<Mt;$++){var Pt=Math.random();_t.push(0,0,0,Pt,1,0,0,Pt,1,1,0,Pt,0,1,0,Pt);var Ht=$*4;Dt.push(Ht+1,Ht+3,Ht+0,Ht+2,Ht+3,Ht+1)}var Bt=new S(P,new Float32Array(_t),"ARRAY_BUFFER"),jt=new S(P,new Uint16Array(Dt),"ELEMENT_ARRAY_BUFFER");startGame=function(){for(var e=0;e<40;e++)qt.push(new It);Jt=!1,Wt=100,Xt=0,L.innerHTML=Xt,T.style.width=Wt*3+"px",Kt(),C.setAttribute("class","hide"),k.setAttribute("class","hide"),$t=+(new Date),O.style.display="none"};var It=function(){this.position=[Math.random()*200,10,Math.random()*200],this.lastTime=+(new Date),this.matrix=c(),v(this.position[0],8,-this.position[1],1,1,1,0,[0,1,0],this.matrix),this.transMatrix=c(),this.randomDir(),this.state=0,this.live=1,this.speed=.002};It.prototype.randomDir=function(){var e=Math.random()-.5,t=Math.random()-.5,n=Math.sqrt(e*e+t*t);this.direction=[e/n,t/n]},It.prototype.updatePosition=function(){var e=+(new Date),t=e-this.lastTime;t=Math.min(30,t),this.lastTime=e,this.speed=(e-$t)*3e-8,this.position[0]+=this.direction[0]*t*this.speed,this.position[2]+=this.direction[1]*t*this.speed;if(this.position[0]<10||this.position[0]>190)this.direction[0]*=-0.9;if(this.position[2]<10||this.position[2]>190)this.direction[1]*=-0.9;Math.random()<.005&&this.randomDir()},It.prototype.render=function(){this.live==1&&this.state>0&&this.state--,this.live==0&&this.state<100&&this.state++,this.live==0&&this.state==100&&(this.position=[Math.random()*200,10,Math.random()*200],this.live=1);var e=at.position[0]-this.position[0],t=at.position[2]+this.position[2],n=Math.sqrt(e*e+t*t);n<50&&(this.direction[0]=e/n,this.direction[1]=-t/n),n<2&&(Wt-=1,Wt<0&&(Wt=0,Ft()),T.style.width=Wt*3+"px"),this.updatePosition(),this.position[1]=W.heightAt(this.position[0],this.position[2]),v(this.position[0],this.position[1]+1,-this.position[2],1,1,1,Math.atan2(-this.direction[0],this.direction[1]),[0,1,0],this.matrix),m(y(at.invMatrix,this.matrix,this.transMatrix)),nt.setUniform("uMVMatrix",this.transMatrix),nt.setUniform("uState",this.state),nt.drawElements()},It.prototype.renderFace=function(){m(y(at.invMatrix,this.matrix,this.transMatrix)),nt.setUniform("uMVMatrix",this.transMatrix),nt.drawElements()};var qt=[],Rt=function(){this.lastTime=+(new Date),this.smat=c(),this.smat2=c(),this.smat3=c()};Rt.prototype.render=function(){var e=+(new Date),t=e-this.lastTime;t=Math.min(30,t),this.lastTime=e;var n=this.smat,r=this.smat2,i=this.smat3;nt.useBuffer(Tt),nt.useElements(Nt);if(e-this.throwStarted<3e3)n[3]+=t*.001*20*n[0],n[7]+=t*.001*20*n[4],n[11]+=t*.001*20*n[8],this.checkBaddies();else{var s=at.matrix;v(-0.6,0,.2,1,1,1,1.4,[0,1,0],r),y(d(1.57,[0,0,1],n),r,i),y(at.matrix,i,n)}m(y(at.invMatrix,n,r)),b(n,i),nt.setUniform("uMVMatrix",r),nt.setUniform("uNMatrix",i),nt.drawElements()},Rt.prototype.thro=function(){this.throwStarted=+(new Date)},Rt.prototype.checkBaddies=function(){for(var e=0;e<qt.length;e++){var t=qt[e],n=t.position[0]-this.smat[3],r=t.position[1]-this.smat[7],i=-t.position[2]-this.smat[11],s=n*n+r*r+i*i;s<6&&(Xt++,L.innerHTML=Xt,t.live=0,this.throwStarted=0)}};var Ut=new Rt,zt=0,Wt=100,Xt=0,Vt=function(e,t){return e.mv[14]<t.mv[14]?1:-1},$t=+(new Date),Jt=!0,Kt=function(){Jt&&(qt=[],at.position=[125,10,-125],at.rotation=[0,0]),nt.clear(),zt+=.02,at.position[0]<7&&(at.position[0]=7),at.position[0]>243&&(at.position[0]=243),at.position[2]>-7&&(at.position[2]=-7),at.position[2]<-243&&(at.position[2]=-243);var e=W.heightAt(at.position[0],-at.position[2]);at.position[1]=e+1.5,nt.useProgram(G),m(y(at.invMatrix,tt,ft)),nt.setUniform("uMVMatrix",ft),nt.setUniform("uNMatrix",b(tt,lt)),nt.useBuffer(J),nt.useElements(K),nt.drawElements(),nt.useProgram(Q),nt.setUniform("uUseAlpha",0);for(var t=0;t<ct.length;t++)m(y(at.invMatrix,ct[t].mat,ht[t].mv)),b(ct[t].mat,ht[t].mn),ht[t].idx=t;ht.sort(Vt);for(var t=0;t<ct.length;t++){ht[t].idx>250?(nt.useBuffer(q),nt.useElements(R),nt.setUniform("texture1",0),nt.setUniform("texture2",1)):(nt.useBuffer(U),nt.useElements(z),nt.setUniform("texture1",6),nt.setUniform("texture2",5));var n=ht[t].mv,r=Math.sqrt(n[12]*n[12]+n[14]*n[14]),i=n[14]/r;if(i<-0.7||r<20)nt.setUniform("uMVMatrix",n),nt.setUniform("uNMatrix",ht[t].mn),nt.drawElements()}nt.setUniform("texture1",0),nt.setUniform("texture2",2),Ut.render(),P.enable(P.BLEND),P.depthMask(!1),P.blendFunc(P.SRC_ALPHA,P.ONE),nt.useProgram(Y),nt.useBuffer(Bt),nt.useElements(jt),nt.setUniform("uTime",+(new Date)-$t);for(var t=0;t<qt.length;t++)qt[t].render();P.disable(P.CULL_FACE),P.blendFunc(P.ONE,P.ONE_MINUS_SRC_ALPHA),nt.useProgram(Q),nt.setUniform("uUseAlpha",1),nt.useBuffer(At),nt.useElements(Ot),nt.setUniform("texture1",8);for(var t=0;t<qt.length;t++)qt[t].renderFace();P.depthMask(!0),P.disable(P.BLEND),P.enable(P.CULL_FACE),Jt||requestAnimFrame(Kt)};Kt(),function(){var e=!1;M.onmousedown=function(t){return t.button===0?e=[t.clientX,t.clientY]:Ut.thro(),t.preventDefault(),!1},M.onmousemove=function(t){e&&!Jt&&(dx=t.clientX-e[0],dy=t.clientY-e[1],at.rotateH(-dx*.01),at.rotateV(-dy*.01),e[0]=t.clientX,e[1]=t.clientY)};var t=[];document.onmouseup=function(t){t.button===0&&(e=!1)},document.addEventListener("keydown",function(e){t[e.keyCode]=!0},!1),document.addEventListener("keyup",function(e){t[e.keyCode]=!1},!1);var n=+(new Date);setInterval(function(){var e=+(new Date),r=e-n;r=Math.min(30,r),n=e,Jt||(t[87]&&at.move(2,-0.1*r*.1),t[83]&&at.move(2,.1*r*.1),t[68]&&at.move(0,.1*r*.1),t[65]&&at.move(0,-0.1*r*.1))},15),document.body.oncontextmenu=function(){return!1}}();document.body.style.display="block"},500)</script></body></html>