/*! pixel-copter - v0.0.1 - 2013-09-18 */HelicopterGame={},function(){for(var a=0,b=["ms","moz","webkit","o"],c=0;c<b.length&&!window.requestAnimationFrame;++c)window.requestAnimationFrame=window[b[c]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[b[c]+"CancelAnimationFrame"]||window[b[c]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(b){var c=(new Date).getTime(),d=Math.max(0,16-(c-a)),e=window.setTimeout(function(){b(c+d)},d);return a=c+d,e}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(a){clearTimeout(a)})}(),function(){var a=!1,b=/xyz/.test(function(){})?/\b_super\b/:/.*/;this.Class=function(){},Class.extend=function(c){function d(){!a&&this.init&&this.init.apply(this,arguments)}var e=this.prototype;a=!0;var f=new this;a=!1;for(var g in c)f[g]="function"==typeof c[g]&&"function"==typeof e[g]&&b.test(c[g])?function(a,b){return function(){var c=this._super;this._super=e[a];var d=b.apply(this,arguments);return this._super=c,d}}(g,c[g]):c[g];return d.prototype=f,d.prototype.constructor=d,d.extend=arguments.callee,d}}(),function(a){var b=Class.extend({init:function(){},font:function(a){context.font="bold "+a+"px"+' "Tahoma", "DejaVu Sans Mono", "Bitstream Vera Sans Mono"'},strokeCircle:function(a,b,c,d,e){this.line(d),this.stroke(e),context.beginPath(),context.arc(a,b,c,0,2*Math.PI,!0),context.closePath(),context.stroke()},fillCircle:function(a,b,c,d){this.line(.5),this.fill(d),context.beginPath(),context.arc(a,b,c,0,2*Math.PI,!0),context.closePath(),context.fill()},fillRect:function(a,b,c,d,e,f){this.fill(e),context.globalAlpha=1,void 0!==f&&(context.globalAlpha=f),context.fillRect(a,b,c,d)},line:function(a){context.lineWidth=a},alpha:function(a){context.globalAlpha=a},text:function(a,b,c,d,e,f){context.fillStyle=f,context.textAlign=d,context.textBaseline=e,context.fillText(c,a,b)},fill:function(a){context.fillStyle=a},stroke:function(a){context.strokeStyle=a},local:function(a,b,c,d,e){context.save(),context.translate(a,b),void 0!==c&&0!==c&&context.rotate(c),void 0!==d&&1!==d&&context.scale(d,e)},unlocal:function(){context.restore()},scale:function(a,b){context.scale(a,b)},strokePolygon:function(a,b,c,d){this.stroke(a),this.line(b),void 0!==d&&1!==d&&context.scale(d,d),context.beginPath(),context.moveTo(c[0][0],c[0][1]);for(var e=1;e<c.length;e++)context.lineTo(c[e][0],c[e][1]);context.closePath(),context.stroke()},fillPolygon:function(a,b,c,d,e,f,g,h){this.fill(a),this.line(b),void 0!==d&&1!==d&&context.scale(d,d),void 0!==e&&0!==e&&context.rotate(e),context.globalAlpha=1,void 0!==h&&(context.globalAlpha=h);var i=0;void 0!==f&&0!==f&&(i=f);var j=0;void 0!==g&&0!==g&&(j=g),context.beginPath(),context.moveTo(i+c[0][0],j+c[0][1]);for(var k=1;k<c.length;k++)context.lineTo(i+c[k][0],j+c[k][1]);context.closePath(),context.fill()},drawImage:function(a,b,c,d,e){context.drawImage(a,b,c,d,e),context.closePath()}});a.HelicopterGame.BaseView=b}(window),function(a){var b=Class.extend({entity:null,x:0,y:0,rotation:0,radius:20,init:function(a){this.entity=a},testCollision:function(a){var b=0,c=0;return b=this.x-a.getBody().x,c=this.y-a.getBody().y,Math.sqrt(b*b+c*c)<=this.radius+a.getBody().radius},wrapAngle:function(a){var b=this.rotation+a;return b>Math.PI&&(b-=2*Math.PI),b<0-Math.PI&&(b+=2*Math.PI),b},wrapPosition:function(){this.x<-16?this.x+=fullWidth:this.x>fullWidth-16&&(this.x-=fullWidth),this.y<-16?this.y+=fullHeight:this.y>fullHeight-16&&(this.y-=fullHeight)}});a.HelicopterGame.Body=b}(window),function(a){var b=Class.extend({_body:null,_physics:null,_view:null,_canvas:null,_eventObj:null,init:function(){},destroy:function(){this._group&&this._group.splice(this._group.indexOf(this),1)},update:function(){this._physics&&this._physics.update()},render:function(){this._view&&this._view.render()},getTime:function(){var a=new Date;return a.getTime()},timeDiff:function(a){return this.getTime()-a},getBody:function(){return this._body},setBody:function(a){this._body=a},getPhysics:function(){return this._physics},setPhysics:function(a){this._physics=a},getHealth:function(){return this._health},getView:function(){return this._view},setView:function(a){this._view=a}});a.HelicopterGame.Entity=b}(window),function(a){var b=Class.extend({entity:null,mr:0,mx:0,my:0,thrust:.25,gravity:.1,speed:0,boost:0,init:function(a){this.entity=a},update:function(){},limitSpeed:function(a,b){var c=this.boost?4.5:3,d=Math.atan2(this.mx,this.my),e=Math.sqrt(Math.pow(a-(a+this.mx),2)+Math.pow(b-(b+this.my),2));e>c&&(e=c),this.mx=Math.sin(d)*e,this.my=Math.cos(d)*e,this.speed=e}});a.HelicopterGame.Physics=b}(window);var Sprite=function(a,b,c){return void 0!==a&&(this.name=a),void 0!==b&&(this.painter=b),this.top=0,this.left=0,this.width=10,this.height=10,this.velocityX=0,this.velocityY=0,this.visible=!0,this.animating=!1,this.behaviors=c||[],this};Sprite.prototype={painter:function(a){this.painter=a},paint:function(a){void 0!==this.painter&&this.visible&&this.painter.paint(this,a)},update:function(a,b){for(var c=0;c<this.behaviors.length;++c)this.behaviors[c].execute(this,a,b)}},function(a){var b=HelicopterGame.BaseView.extend({scale:1,a:0,sprite:null,init:function(){},render:function(){}});a.HelicopterGame.View=b}(window),function(a){var b=Class.extend({entities:[],isPaused:!1,that:this,counter:0,_map:null,_powerUps:null,_helicopter:null,init:function(){that=this,this.addMap(),this.addPowerUps(),this.addHelicopter(),this._map.testCollision(this._helicopter),that.update(),that.render()},loop:function(){that.update(),that.render(),requestAnimationFrame(that.loop)},update:function(){context.clearRect(0,0,canvas.width,canvas.height);for(var a=0,b=this.entities.length;b>a;a++)this.entities[a].update();this._map.isGameOver()&&(console.log("Game Over"),this.endGame(),that.isPaused=!0),0===this.counter%1e3&&this.counter>1&&this._powerUps.addFuelItem(this._map.lastYPos,this._map.lastHeight),this._helicopter.getBody().testCollision(this._powerUps)&&(this._powerUps.powerUpToken(),HelicopterGame.UI.displayFuel(!1),console.log("powerUp taken")),that.isPaused||(HelicopterGame.UI.displayFuel(!0),HelicopterGame.UI.getFuel()<1&&this._helicopter.endFuel()),this.counter++},render:function(){this.drawBackground();for(var a=0,b=this.entities.length;b>a;a++)this.entities[a].render()},onAddedToStage:function(){},startGame:function(){console.log("startGame"),this.loop()},stopGame:function(){for(var a=0,b=this.entities.length;b>a;a++){this.entities[a].entity.getView()}},endGame:function(){that.isPaused||(this._map.endGame(),this._powerUps.endGame(),this._helicopter.endGame(),HelicopterGame.UI.showEnd())},addEntity:function(a){return this.entities.push(a),a.getView(),a},onEntityDestroyed:function(a){this.entities.splice(entities.indexOf(a),1),a.getView()},drawBackground:function(){context.fillStyle="#666666",context.fillRect(0,0,fullWidth,fullHeight)},addMap:function(){this._map=new HelicopterGame.Map,this.addEntity(this._map)},addPowerUps:function(){this._powerUps=new HelicopterGame.PowerUps,this.addEntity(this._powerUps)},addHelicopter:function(){this._helicopter=new HelicopterGame.Helicopter,this.addEntity(this._helicopter)}});a.HelicopterGame.Game=b}(window),function(a){var b=function(){var a,b=this,c=100,d=function(a){return document.getElementById(a)},e=d("intro"),f=d("distance"),g=d("fuel"),h=function(a){a.style.display="block"},i=function(a){a.style.display="none"},j=function(){h(e),d("begin").addEventListener("click",function(){setTimeout(function(){i(e),h(f),h(g),b.game.startGame()},100)},!1)},k=function(){var b;"undefined"!=typeof localStorage.getItem("score")?(b=localStorage.getItem("score"),console.log("endDistance: "+a+" highScore: "+b),Number(a)>Number(b)&&(console.log("new high Score"),localStorage.setItem("score",a),d("end-info").innerHTML="Congratulations!! You've beat your previous high score.",d("end-highScore").innerHTML="Your previous high score:")):(localStorage.setItem("score",a),b=localStorage.getItem("score")),d("end-distance").innerHTML=a+" kms",d("best-distance").innerHTML=b+" kms",setTimeout(function(){h(d("end")),d("again").addEventListener("click",function(){document.location.reload(!0)},!1)},500)},l=function(b){a=b.toFixed(1),f.innerHTML="Distance: "+a+" kms"},m=function(a){a?c-=.035:(c+=50,c>100&&(c=100)),d("remaining").style.width=Math.floor(c)+"px"},n=function(){return c};return{getFuel:n,showIntro:j,showEnd:k,displayDistance:l,displayFuel:m}}();a.HelicopterGame.UI=b}(window),function(a){var b=Class.extend({keys:{},init:function(){console.log("GamePad.init()")},checkInput:function(){for(var a in c.keys)2===c.keys[a]&&(c.keys[a]=0);this.keys={SPACE:{keyCode:32,keyPressed:0},ENTER:{keyCode:13,keyPressed:0},RIGHT:{keyCode:39,keyPressed:0},LEFT:{keyCode:37,keyPressed:0}};for(var a in this.keys)this.keys[a].keyPressed=c.keys[this.keys[a].keyCode]},isKeyPressed:function(a){return this.keys[a].keyPressed}}),c=this;this.keys={},window.addEventListener("touchstart",function(){c.keys[32]=1},!1),window.addEventListener("touchend",function(){c.keys[32]=0},!1),window.onkeydown=window.onkeyup=function(a){var b=a.keyCode;return 116===b||a.shiftKey||a.altKey||a.ctrlKey||(c.keys[b]="keydown"===a.type?1:0,!c.playing)?void 0:(a.preventDefault(),!1)},a.HelicopterGame.GamePad=b}(window),function(a){var b=HelicopterGame.Entity.extend({view:null,body:null,physics:null,gamePad:null,color:"#FF0000",helicopterColor:"#666666",helicopterExplosionColor:"#333333",helicopterExplosionScale:1,smokeColor:"#666666",helicopterBodyShape:null,helicopterCrashedBodyShape:null,smokesArray:[],smokeFrequency:10,counter:0,isPlaying:!0,hasFuel:!0,init:function(){var a=-52,b=-15;this.helicopterBodyShape=[[0+a,9.5+b,4,10],[0+a,15.5+b,73,4],[40.5+a,9.25+b,28,18],[68+a,15.5+b,12,7.5],[63+a,19.5+b,12,7.5],[29+a,15.5+b,12,7.5],[15.5+a,2+b,77,3.5],[51.5+a,0+b,6,2],[51.5+a,6+b,6,3.5]],this.helicopterCrashedBodyShape=[[5,-32],[8,-13],[31,-12],[16,-1],[32,18],[8,9],[-2,30],[-9,9],[-32,6],[-12,-3],[-27,-22],[-3,-10]],this.body=this.getBody(),this.body=new HelicopterGame.Body(this),this.body.x=280,this.body.y=200,this.body.rotation=2*90*Math.PI-Math.PI,this.body.radius=15,this.setBody(this.body),this.physics=this.getPhysics(),this.physics=new HelicopterGame.Physics(this),this.physics.mr=0,this.physics.mx=0,this.physics.my=0,this.view=this.getView(),this.view=new HelicopterGame.View,this.view.alpha=1;var c=this;this.view.spritePainter={paint:function(){if(c.isPlaying?c.view.local(c.body.x,c.body.y,c.body.rotation):c.view.local(c.body.x,c.body.y+15,c.body.rotation),c.isPlaying){var a;for(i=0;i<c.helicopterBodyShape.length;i++)6==i&&0===c.counter%2&&(a=c.helicopterBodyShape[6],77==a[2]?(a[0]=-16.5,a[2]=40):40==a[2]?(a[0]=-36.5,a[2]=0):0==a[2]?0===c.counter%5&&(a[0]=-16.5,a[2]=39):39==a[2]&&(a[0]=-36.5,a[2]=77)),c.view.fillRect(c.helicopterBodyShape[i][0],c.helicopterBodyShape[i][1],c.helicopterBodyShape[i][2],c.helicopterBodyShape[i][3],c.helicopterColor)}else{var b=1-c.helicopterExplosionScale/2;c.view.fillPolygon(c.helicopterExplosionColor,5,c.helicopterCrashedBodyShape,c.helicopterExplosionScale,1*c.helicopterExplosionScale,0,0,b),c.helicopterExplosionScale<1.9?c.helicopterExplosionScale+=.05:c.helicopterExplosionScale=2}if(c.view.unlocal(),c.view.local(c.body.x,c.body.y),c.isPlaying&&0===c.counter%c.smokeFrequency){var d={xPos:-52,yPos:c.body.y-5-50*c.body.rotation,width:10,height:10,alpha:1};c.smokesArray.push(d)}for(i=c.smokesArray.length-1;i>=0;i--)c.smokesArray[i].xPos-=4,c.smokesArray[i].width+=.2,c.smokesArray[i].height+=.2,c.smokesArray[i].alpha-=.01,c.view.fillRect(c.smokesArray[i].xPos,c.smokesArray[i].yPos-c.body.y,c.smokesArray[i].width,c.smokesArray[i].height,c.smokeColor,c.smokesArray[i].alpha),c.smokesArray[i].alpha<0&&c.smokesArray.splice(i,1);c.view.unlocal(),c.counter++}},this.view.sprite=new Sprite("helicopter",this.view.spritePainter),console.log("painting the Helicopter sprite"),this.view.spritePainter.paint(this.view.sprite,context),this.gamePad=new HelicopterGame.GamePad},render:function(){this.view.spritePainter.paint(this.view.sprite,context)},update:function(){this.isPlaying&&(this.gamePad.checkInput(),this.gamePad.isKeyPressed("SPACE")&&this.hasFuel&&(this.physics.my-=this.physics.thrust),this.physics.my+=this.physics.gravity,this.physics.mr=Math.atan2(this.physics.my/2,this.body.x),this.body.rotation=180*this.physics.mr/Math.PI,this.body.y+=this.physics.my)},endFuel:function(){this.hasFuel=!1},endGame:function(){this.isPlaying=!1}});a.HelicopterGame.Helicopter=b}(window),function(a){var b=HelicopterGame.Entity.extend({view:null,body:null,physics:null,color:"#CCCCCC",wallBlockWidth:4,wallBlocksArray:[],counter:0,level:2,levelFrequency:2e3,levelIncreament:1100,heightReductionByLevel:0,sineWaveCounter:0,sineWaveIncrease:0,lastYPos:300,lastHeight:300,_helicopter:void 0,isPlaying:!0,init:function(){this.sineWaveIncrease=2*Math.PI/(400-30*this.level),this.body=this.getBody(),this.body=new HelicopterGame.Body(this),this.body.rotation=0,this.body.radius=20,this.physics=new this.getPhysics,this.physics=new HelicopterGame.Physics(this),this.physics.mr=0,this.physics.mx=5*Math.random()-3,this.physics.my=5*Math.random()-3,this.view=new this.getView,this.view=new HelicopterGame.View,this.view.alpha=1;var a,b=this;this.heightReductionByLevel=40*this.level;var c=585-this.heightReductionByLevel;for(i=0;i<fullWidth/this.wallBlockWidth;i++){var d=this.getNewHeightValue(c),e=this.getNewYPosValue(d);a={xPos:i*this.wallBlockWidth,yPos:e,height:d},this.wallBlocksArray.push(a),c=d}this.view.spritePainter={paint:function(a,c,d){var e;if(b.view.local(b.body.x,b.body.y),d){b.wallBlocksArray.shift();var f=b.wallBlocksArray[b.wallBlocksArray.length-1],g=b.getNewHeightValue(f.height),h=b.getNewYPosValue(g);b.lastYPos=h,b.lastHeight=g,e={xPos:f.xPos+b.wallBlockWidth,yPos:h,height:g},b.wallBlocksArray.push(e)}for(var i=0;i<b.wallBlocksArray.length;i++)e=b.wallBlocksArray[i],b.view.fillRect(e.xPos,e.yPos,b.wallBlockWidth,e.height,b.color),e.xPos+b.body.x>232&&e.xPos+b.body.x<327&&("undefined"!=typeof b._helicopter&&b._helicopter.body.y+20<e.yPos&&(b.isPlaying=!1),"undefined"!=typeof b._helicopter&&b._helicopter.body.y-5>e.yPos+e.height&&(b.isPlaying=!1));b.view.unlocal(),b.view.local(b.body.x,b.body.y),b.view.unlocal()}},this.view.sprite=new Sprite("asteroid"+100*Math.random(),this.view.spritePainter),this.view.spritePainter.paint(this.view.sprite,context)},render:function(){0===this.body.x%this.wallBlockWidth&&0!==this.body.x&&this.isPlaying?this.view.spritePainter.paint(this.view.sprite,context,!0):this.view.spritePainter.paint(this.view.sprite,context,!1)},update:function(){this.isPlaying&&(this.body.x-=4,0===this.counter%this.levelFrequency&&(this.level++,this.levelFrequency+=this.levelIncreament),this.counter++,HelicopterGame.UI.displayDistance(.1*this.counter))},getNewHeightValue:function(a){this.heightReductionByLevel=40*this.level;var b,c=8;return b=a>=fullHeight-20-this.heightReductionByLevel?a-c:a<fullHeight-150-this.heightReductionByLevel?a+c:1*Math.random()>.5?a+c:a-=c},getNewYPosValue:function(a){var b=Math.sin(this.sineWaveCounter)/2+.5;return b=(fullHeight-180)/2+180*b,this.sineWaveCounter+=this.sineWaveIncrease,b-=a/2},testCollision:function(a){this._helicopter=a},isGameOver:function(){return!this.isPlaying},endGame:function(){this.isPlaying=!1}});a.HelicopterGame.Map=b}(window),function(a){var b=HelicopterGame.Entity.extend({view:null,body:null,physics:null,image:null,imageUrl:"images/fuel_icon_22.png",isPlaying:!0,counter:0,init:function(){this.body=new HelicopterGame.Body(this),this.body.x=-30,this.body.y=0,this.body.rotation=2*90*Math.PI-Math.PI,this.setBody(this.body),this.physics=this.getPhysics(),this.physics=new HelicopterGame.Physics(this),this.view=this.getView(),this.view=new HelicopterGame.View,this.view.alpha=1;var a=this;this.image=new Image,this.image.src=this.imageUrl,this.view.spritePainter={paint:function(){a.image.complete&&(a.view.local(a.body.x,a.body.y),a.view.strokeCircle(-1,0,18,2,"#333333"),a.view.drawImage(a.image,-a.image.width/2,-11,a.image.width,a.image.height),a.view.unlocal()),a.counter++}},this.view.sprite=new Sprite("PowerUps",this.view.spritePainter),console.log("painting the PowerUps sprite"),this.view.spritePainter.paint(this.view.sprite,context)},render:function(){this.view.spritePainter.paint(this.view.sprite,context)},update:function(){this.isPlaying&&this.body.x>-30&&(this.body.x-=4)},addFuelItem:function(a,b){console.log("yPos: "+a+" height: "+b),this.body.y=a+25+Math.random()*(b-50),this.body.x=fullWidth},powerUpToken:function(){this.body.x=-30},endGame:function(){this.isPlaying=!1}});a.HelicopterGame.PowerUps=b}(window);